[概要]
このプログラムはカメラ画像入力の顔認識と、認識データのストリーミング(TCP/IP)を行います。

[リリースノート]
2023/07/05　顔の向き・性別・年齢認識機能を追加
2023/06/07　ソフトウェア配布用リリース

[実行環境]
Windows10〜
Python3.9〜

[準備]
pip install -r requirement.txt

[実行]
・実行方法
　run.batを実行
・実行引数
　-d カメラデバイスIDを指定。デフォルトは0
　-p サーバのポート番号を指定。デフォルトは4500
　-di deepfaceの認識インターバルの指定(sec)。-1を指定するとdeepface認識を行わない。デフォルトは5
・終了方法
　画像表示ウィンドウをアクティブにした状態でEscキー


[認識データ]
認識データは以下の内容を含みます。
・表情
・顔の向き(pitch, roll, yaw)
・年齢
・性別

[認識データ(ストリーミング)]
TCP/IPクライアントとしてサーバに接続すると、下記のようなJsonデータがサーバから送信されます。
{"timestamp": 1688538712.4629924, "emotion_class": "neutral", "emotion_score": 0.6734067797660828, "rotation": {"pitch": 0.6194981801431012, "roll": -9.570775799382096, "yaw": -2.8118400203755725}, "age": 28, "gender_class": "Man", "gender_score": 99.167001247406}
データは改行(\n)区切りで送信されます。受信側では改行区切りでパースしてください。

[認識データ(表情)]
emotionの分類は、neutral, happy, surprise, sad, angry, disgust, fearの7つです。
詳細については、使用している表情認識ライブラリpypaz(https://github.com/oarriaga/paz)を参照してください。

[認識データ(顔の向き)]
顔の向きはmediapipe(https://github.com/google/mediapipe)によって認識されたfacemeshの情報を元に推定されます。
pitch, roll, yawのデータはそれぞれ角度で出力されます。

[認識データ(年齢・性別)]
年齢・性別の認識にはdeepface(https://github.com/serengil/deepface)を使用します。
初回起動時には年齢・性別の認識モデル(それぞれ約500MB)がダウンロードされます。
年齢・性別認識は毎フレーム行う処理ではないため、-diオプションで指定した一定秒数ごとに認識処理を行います。
ストリーミングデータにも指定秒数に一度だけ年齢・性別データが含まれます。


[備考]
このプログラムはカメラ内に一人の人物が映る場面を想定しています。
複数の顔がカメラ画像内に存在する場合は、最も大きく映った顔のみを認識対象とします。
